<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>IdxAi â€” Sooonnn (AR + Dance)</title>

  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    :root{
      --glass: rgba(255,255,255,.12);
      --border: rgba(255,255,255,.22);
      --ink: rgba(255,255,255,.92);
    }
    html, body{height:100%;margin:0;overflow:hidden;background:#050b18;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;}
    #sea{position:fixed;inset:0;width:100%;height:100%;display:block;}
    .vignette{position:fixed;inset:-25%;background:
      radial-gradient(circle at 50% 40%, rgba(255,255,255,.08), transparent 45%),
      radial-gradient(circle at 20% 15%, rgba(0,255,255,.08), transparent 35%),
      radial-gradient(circle at 80% 75%, rgba(255,200,0,.06), transparent 40%);
      pointer-events:none;mix-blend-mode:screen;transform:translate3d(0,0,0);
    }
    .hud{position:fixed;inset:14px 14px auto 14px;display:flex;align-items:flex-start;justify-content:space-between;gap:10px;z-index:20;}
    .badge{padding:12px 14px;border-radius:18px;background:var(--glass);border:1px solid var(--border);color:var(--ink);backdrop-filter:blur(10px);max-width:78vw;}
    .badge h1{margin:0;font-size:18px}
    .badge p{margin:6px 0 0;font-size:13px;opacity:.88;line-height:1.35}
    .miniBtn{border:1px solid var(--border);background:rgba(255,255,255,.10);color:var(--ink);padding:10px 12px;border-radius:14px;backdrop-filter:blur(10px);cursor:pointer;user-select:none;white-space:nowrap;}

    .stage{position:fixed;inset:100px 14px 92px 14px;display:grid;place-items:center;z-index:10;}
    .viewerWrap{
      width:min(560px,96vw);height:min(660px,66vh);
      border-radius:28px;background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.18);backdrop-filter:blur(10px);
      box-shadow:0 30px 70px rgba(0,0,0,.45);
      overflow:hidden;position:relative;
      transform: translate3d(0,0,0);
    }
    model-viewer{width:100%;height:100%;background:transparent;}

    .overlayText{
      position:absolute;inset:14px 14px auto 14px;display:flex;align-items:center;justify-content:space-between;
      z-index:5;pointer-events:none;color:#fff;text-shadow:0 12px 40px rgba(0,0,0,.65);
    }
    .brand{font-weight:900;letter-spacing:.8px;font-size:22px}
    .soon{font-weight:900;opacity:.95}

    .status{
      position:absolute;left:14px;right:14px;bottom:14px;z-index:6;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:10px 12px;border-radius:16px;background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.16);color:rgba(255,255,255,.92);
      backdrop-filter:blur(10px);font-size:12px;
    }
    .pill{padding:7px 10px;border-radius:999px;background:rgba(0,255,255,.14);border:1px solid rgba(255,255,255,.18);font-weight:800;white-space:nowrap;}

    .bottom{position:fixed;inset:auto 14px 14px 14px;z-index:20;display:flex;gap:10px;flex-wrap:wrap;justify-content:center;}
    .cta{border:1px solid rgba(255,255,255,.22);background:rgba(0,255,255,.14);color:#fff;padding:12px 14px;border-radius:14px;cursor:pointer;font-weight:850;transition:transform .15s ease;}
    .cta.secondary{background:rgba(255,255,255,.10);}
    .note{width:100%;text-align:center;color:rgba(255,255,255,.86);font-size:12px;opacity:.92}

    .shakeToast{
      position:fixed;left:50%;bottom:92px;transform:translateX(-50%) translateY(20px);
      opacity:0;transition:opacity .18s ease, transform .18s ease;z-index:30;
      padding:10px 12px;border-radius:16px;background:rgba(0,0,0,.45);
      border:1px solid rgba(255,255,255,.16);color:rgba(255,255,255,.92);
      backdrop-filter:blur(10px);font-size:12px;pointer-events:none;text-align:center;max-width:86vw;
    }
    .shakeToast.on{opacity:1;transform:translateX(-50%) translateY(0);}

    /* Ø±Ù‚ØµØ© CSS Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© ÙƒÙ€ fallback */
    .danceCard{
      animation: bounce 0.55s ease-in-out infinite alternate, sway 1.2s ease-in-out infinite;
    }
    @keyframes bounce{ from{ transform:translate3d(0,0,0);} to{ transform:translate3d(0,-10px,0);} }
    @keyframes sway{ 0%,100%{ filter: drop-shadow(0 25px 40px rgba(0,0,0,.35)); } 50%{ filter: drop-shadow(0 35px 55px rgba(0,0,0,.45)); } }
  </style>
</head>

<body>
  <canvas id="sea"></canvas>
  <div class="vignette" id="vignette"></div>

  <div class="hud">
    <div class="badge">
      <h1>IdxAi â€” Ø±ÙˆØ¨ÙˆØª ÙŠØ±Ù‚Øµ + AR</h1>
      <p>Ø§Ø¶ØºØ· â€œDanceâ€ Ù„ØªØ´ØºÙŠÙ„ Ø±Ù‚ØµØ©. Ù‡Ø²Ù‘ Ø§Ù„Ø¬ÙˆØ§Ù„ ÙŠØ¬Ù‡Ø² Ø²Ø± AR.</p>
    </div>
    <button class="miniBtn" id="motionBtn">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ©</button>
  </div>

  <div class="stage">
    <div class="viewerWrap" id="wrap">
      <div class="overlayText">
        <div class="brand">IdxAi</div>
        <div class="soon">Sooonnn</div>
      </div>

      <model-viewer id="mv"
        src="https://modelviewer.dev/shared-assets/models/RobotExpressive.glb"
        ios-src="https://modelviewer.dev/shared-assets/models/RobotExpressive.usdz"
        ar
        ar-modes="webxr scene-viewer quick-look"
        camera-controls
        auto-rotate
        shadow-intensity="0.9"
        exposure="1.0"
        alt="IdxAi Robot"
        autoplay>
      </model-viewer>

      <div class="status">
        <div id="statusText">Ø§Ù„Ø­Ø§Ù„Ø©: Ø¬Ø§Ù‡Ø² âœ…</div>
        <div class="pill" id="animPill">ANIM: ÙØ­Øµâ€¦</div>
      </div>
    </div>
  </div>

  <div class="shakeToast" id="toast">Ù‡Ø²Ù‘Ø©! Ø§Ù„Ø¢Ù† Ø§Ø¶ØºØ· â€œØ§ÙØªØ­ AR Ø§Ù„Ø¢Ù†â€ ğŸ‘‡</div>

  <div class="bottom">
    <button class="cta" id="danceBtn">Dance ğŸ•º</button>
    <button class="cta secondary" id="stopBtn">Stop</button>
    <button class="cta" id="arBtn">Ø§ÙØªØ­ AR Ø§Ù„Ø¢Ù†</button>
    <div class="note">Ù…Ù‡Ù…: AR ÙŠØ­ØªØ§Ø¬ HTTPS + Chrome/Safari. Ø§Ù„Ø±Ù‚ØµØ© ØªØ¹Ù…Ù„ Ø­ØªÙ‰ Ø¨Ø¯ÙˆÙ† AR.</div>
  </div>

<script>
(() => {
  // ===== Ø¨Ø­Ø± Ù…ØªØ­Ø±Ùƒ =====
  const canvas = document.getElementById('sea');
  const ctx = canvas.getContext('2d', { alpha:false });
  let W=0, H=0, t=0;

  function resize(){
    W = canvas.width = innerWidth * devicePixelRatio;
    H = canvas.height = innerHeight * devicePixelRatio;
  }
  addEventListener('resize', resize, {passive:true});
  resize();

  let tiltX=0, tiltY=0;
  const vignette = document.getElementById('vignette');
  const wrap = document.getElementById('wrap');

  function drawSea(){
    t += 0.008;
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0, '#030817'); g.addColorStop(1, '#062a3a');
    ctx.fillStyle = g; ctx.fillRect(0,0,W,H);

    for(let l=0; l<4; l++){
      const yBase = H*(0.45 + l*0.12) + tiltY*18*devicePixelRatio;
      const amp  = (18 + l*10) * devicePixelRatio;
      const freq = 0.006 + l*0.0015;
      const speed= 0.7 + l*0.35;

      ctx.beginPath();
      for(let x=0; x<=W; x += 8*devicePixelRatio){
        const y = yBase
          + Math.sin((x*freq) + t*speed + l)*amp
          + Math.sin((x*freq*1.6) + t*speed*1.2)*amp*0.25;
        if(x===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.lineTo(W,H); ctx.lineTo(0,H); ctx.closePath();
      ctx.fillStyle = `rgba(0, ${120+l*18}, ${140+l*22}, ${0.14+l*0.05})`;
      ctx.fill();
    }
    requestAnimationFrame(drawSea);
  }
  drawSea();

  // ===== Controls =====
  const mv = document.getElementById('mv');
  const arBtn = document.getElementById('arBtn');
  const danceBtn = document.getElementById('danceBtn');
  const stopBtn = document.getElementById('stopBtn');
  const motionBtn = document.getElementById('motionBtn');
  const toast = document.getElementById('toast');
  const statusText = document.getElementById('statusText');
  const animPill = document.getElementById('animPill');

  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add('on');
    setTimeout(()=>toast.classList.remove('on'), 1600);
  }

  // --- Ù‚Ø§Ø¦Ù…Ø© Ø£Ù†ÙŠÙ…ÙŠØ´Ù†Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ ---
  let animations = [];
  function pickDanceName(list){
    const lower = list.map(a => String(a).toLowerCase());
    const candidates = ["dance", "dancing", "hiphop", "shuffle", "wave", "run", "walk", "idle"];
    for (const c of candidates){
      const idx = lower.findIndex(x => x.includes(c));
      if (idx >= 0) return list[idx];
    }
    return list[0] || null;
  }

  mv.addEventListener('load', () => {
    animations = (mv.availableAnimations || []).slice();
    if (animations.length){
      animPill.textContent = "ANIM: " + animations.length;
      statusText.textContent = "Ø§Ù„Ø­Ø§Ù„Ø©: ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙˆØ¨ÙˆØª âœ…";
    } else {
      animPill.textContent = "ANIM: none";
      statusText.textContent = "Ø§Ù„Ø­Ø§Ù„Ø©: Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†ÙŠÙ…ÙŠØ´Ù†Ø§Øª â€” Ø³Ù†Ø³ØªØ®Ø¯Ù… Ø±Ù‚ØµØ© CSS.";
    }
  });

  // --- Ø²Ø± AR ---
  arBtn.addEventListener('click', async ()=>{
    try{
      statusText.textContent = "Ø§Ù„Ø­Ø§Ù„Ø©: Ù…Ø­Ø§ÙˆÙ„Ø© ÙØªØ­ ARâ€¦";
      await mv.activateAR();
      statusText.textContent = "Ø§Ù„Ø­Ø§Ù„Ø©: ØªÙ… ÙØªØ­ AR âœ…";
    }catch(e){
      statusText.textContent = "Ø§Ù„Ø­Ø§Ù„Ø©: AR ØºÙŠØ± Ù…ØªØ§Ø­ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²/Ø§Ù„Ù…ØªØµÙØ­.";
      showToast("AR ØºÙŠØ± Ù…ØªØ§Ø­ Ù‡Ù†Ø§. Ø¬Ø±Ù‘Ø¨ Chrome + ARCore + HTTPS.");
      console.warn(e);
    }
  });

  // --- Dance ---
  let dancing = false;
  function startDance(){
    dancing = true;
    wrap.classList.add('danceCard');

    if (animations.length){
      const name = pickDanceName(animations);
      mv.animationName = name;
      mv.autoplay = true;
      mv.play();
      animPill.textContent = "ANIM: " + name;
      statusText.textContent = "Ø§Ù„Ø­Ø§Ù„Ø©: Ø§Ù„Ø±ÙˆØ¨ÙˆØª ÙŠØ±Ù‚Øµ âœ…";
      showToast("Dance: " + name);
    } else {
      statusText.textContent = "Ø§Ù„Ø­Ø§Ù„Ø©: Ø±Ù‚ØµØ© CSS âœ…";
      showToast("Dance (CSS) âœ…");
    }
  }

  function stopDance(){
    dancing = false;
    wrap.classList.remove('danceCard');
    try { mv.pause(); } catch {}
    statusText.textContent = "Ø§Ù„Ø­Ø§Ù„Ø©: ØªÙˆÙ‚Ù âœ…";
    showToast("Stop âœ…");
  }

  danceBtn.addEventListener('click', startDance);
  stopBtn.addEventListener('click', stopDance);

  // ===== Motion (Tilt + Shake) =====
  let motionEnabled = false;
  let lastShake = 0;

  function onOrientation(e){
    const g = (e.gamma ?? 0);
    const b = (e.beta  ?? 0);
    tiltX = Math.max(-1, Math.min(1, g / 30));
    tiltY = Math.max(-1, Math.min(1, b / 30));

    vignette.style.transform = `translate3d(${tiltX*14}px, ${tiltY*10}px, 0)`;
    if (!dancing){
      wrap.style.transform = `translate3d(${tiltX*8}px, ${tiltY*6}px, 0) rotate(${tiltX*2.5}deg)`;
    }
  }

  function onMotion(e){
    const a = e.accelerationIncludingGravity;
    if(!a) return;
    const ax=a.x||0, ay=a.y||0, az=a.z||0;
    const mag = Math.sqrt(ax*ax + ay*ay + az*az);
    const now = performance.now();

    if (mag > 18 && (now - lastShake) > 1200){
      lastShake = now;

      // Ù„Ø§ Ù†ÙØªØ­ AR ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ (Ù‚ÙŠÙˆØ¯ Ø§Ù„Ø£Ù…Ø§Ù†) â€” Ù†Ø¬Ù‡Ø² Ø²Ø± AR
      arBtn.style.transform = "scale(1.12)";
      arBtn.textContent = "Ù‡Ø²Ù‘Ø©! Ø§Ø¶ØºØ· Ù„ÙØªØ­ AR Ø§Ù„Ø¢Ù†";
      arBtn.scrollIntoView({behavior:"smooth", block:"center"});
      if (navigator.vibrate) navigator.vibrate([60, 40, 60]);
      showToast("Ù‡Ø²Ù‘Ø©! Ø²Ø± AR Ø¬Ø§Ù‡Ø² ğŸ‘‡");
      setTimeout(()=>{
        arBtn.style.transform = "scale(1)";
        arBtn.textContent = "Ø§ÙØªØ­ AR Ø§Ù„Ø¢Ù†";
      }, 1600);
    }
  }

  async function enableMotion(){
    if (motionEnabled) return;
    try{
      if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
        const r = await DeviceMotionEvent.requestPermission();
        if (r !== 'granted') { showToast("ØªÙ… Ø±ÙØ¶ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø­Ø±ÙƒØ©."); return; }
      }
      window.addEventListener('deviceorientation', onOrientation, {passive:true});
      window.addEventListener('devicemotion', onMotion, {passive:true});
      motionEnabled = true;
      motionBtn.textContent = "Ø§Ù„Ø­Ø±ÙƒØ© Ù…ÙØ¹Ù„Ø© âœ“";
      showToast("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ© âœ…");
    }catch(err){
      motionBtn.textContent = "ØªØ¹Ø°Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„";
      showToast("ØªØ¹Ø°Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ©.");
      console.warn(err);
    }
  }

  motionBtn.addEventListener('click', enableMotion);
  window.addEventListener('click', () => { if (!motionEnabled) enableMotion(); }, { once:true });
})();
</script>
</body>
</html>
